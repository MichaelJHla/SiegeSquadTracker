<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <link rel="stylesheet" href="../css/global.css">
    <link rel="stylesheet" href="../css/site-stats.css">
    <title>Siege Squad Tracker - Site Stats</title>
</head>

<body>
    <div id="header">
        <h1 id="squad-name"><a href="squad.html">Squad Name</a></h1>
        <div id="nav-elements">
            <h2><a href="map-bans.html">Map Ban Helper</a></h2>
            <h2><a href="operator-bans.html">Operator Bans</a></h2>
            <h2><a href="#">Site Stat Tracker</a></h2>
        </div>
    </div>

    <div id="body">
        <div id="options">
            <div id="map-selection-div">
                <label for="map-selection">Choose a map:</label>
                <select id="map-selection" class="dropdown" onchange="loadSites()">
                    <option value="default" disabled selected value> -- select a map -- </option>
                    <option value="bank">Bank</option>
                    <option value="border">Border</option>
                    <option value="chalet">Chalet</option>
                    <option value="clubhouse">Clubhouse</option>
                    <option value="coastline">Coastline</option>
                    <option value="consulate">Consulate</option>
                    <option value="kafe">Kafe</option>
                    <option value="kanal">Kanal</option>
                    <option value="oregon">Oregon</option>
                    <option value="outback">Outback</option>
                    <option value="skyscraper">Skyscraper</option>
                    <option value="park">Theme Park</option>
                    <option value="villa">Villa</option>
                </select>
            </div>

            <div id="site-selection-div">
                <label for="site-selection">Choose a site:</label>
                <select id="site-selection" class="dropdown" onchange="loadSiteData()">
                    <option value="default" disabled selected value> -- select a site -- </option>
                    <option value="0" id="site0"></option>
                    <option value="1" id="site1"></option>
                    <option value="2" id="site2"></option>
                    <option value="3" id="site3"></option>
                </select>
            </div>
        </div>

        <div id="all-site-info">
            <div id="view-data">
                <div id="attacking-div" class="data-section">
                    <div id="attacking-wl" class="data-subsection">
                        <h3 id="attacking-wins">Attacking wins:</h3>
                        <h3 id="attacking-losses">Attacking losses:</h3>
                    </div>

                    <div id="attacking-planting" class="data-subsection">
                        <h3 id="successful-plants">Successful defuser plants:</h3>
                        <h3 id="failed-plants">Failed defuser plants:</h3>
                    </div>
                </div>

                <div id="defending-div" class="data-section">
                    <div id="defending-wl" class="data-subsection">
                        <h3 id="defending-wins">Defending wins:</h3>
                        <h3 id="defending-losses">Defending losses:</h3>
                    </div>

                    <div id="defending-planting" class="data-subsection">
                        <h3 id="successful-disables">Defusers disabled:</h3>
                        <h3 id="failed-disables">Defusers not disabled:</h3>
                    </div>
                </div>
            </div>
            <div id="add-data">
                <div id="role-div" class="radio-section">
                    <input id="attack" type="radio" value="a" name="role" onclick="checkAllRadio()">
                    <label for="attack">Attacking</label>
                    <input id="defend" type="radio" value="d" name="role" onclick="checkAllRadio()">
                    <label for="defend">Defending</label>
                </div>

                <div id="win-loss-div" class="radio-section">
                    <input id="win" type="radio" value="win" name="success" onclick="checkAllRadio()">
                    <label for="win">Won</label>
                    <input id="loss" type="radio" value="loss" name="success" onclick="checkAllRadio()">
                    <label for="loss">Lost</label>
                </div>

                <div id="planted-div" class="radio-section">
                    <input id="yes" type="radio" value="yes" name="planted" onclick="checkAllRadio()">
                    <label for="yes">Planted</label>
                    <input id="no" type="radio" value="no" name="planted" onclick="checkAllRadio()">
                    <label for="no">Not planted</label>
                </div>

                <div id="submit-div">
                    <button id="submit" onclick="submitSiteData()">Submit</button>
                </div>
            </div>
        </div>
    </div>

    <!--All scripts below here-->
    <!-- Firebase App (the core Firebase SDK) is always required and must be listed first -->
    <script src="https://www.gstatic.com/firebasejs/8.1.1/firebase-app.js"></script>
    <!-- Database CDN -->
    <script src="https://www.gstatic.com/firebasejs/8.1.1/firebase-database.js"></script>
    <!--Configuration information for firebase-->
    <script src="../scripts/firebaseConfig.js"></script>

    <!--jQuery import-->
    <script src="../scripts/jquery.js"></script>

    <script>
        //This will assign the proper squad name to the proper header
        var squadName = "Goop Gang";
        var userName = "DJ XB0XER";
        $('#squad-name').text(squadName);
    </script>

    <script>
        //This map associates each map with its list of 4 sites
        var allSites = new Map([
            ["bank", ["Executive Lounge and CEO", "Staff Room and Open Area", "Teller's Office and Archives", "Lockers and CCTV"]],
            ["border", ["Customs and Supply Room", "Workshop and Ventilation", "Tellers and Bathroom", "Armory Lockers and Archives"]],
            ["chalet", ["Master Bedroom and Office", "Bar and Gaming Room", "Dining Room and Kitchen", "Wine Cellar and Snowmobile Garage"]],
            ["clubhouse", ["Gym and Bedroom", "CCTV and Cashroom", "Bar and Stock Room", "Church and Arsenal Room"]],
            ["coastline", ["Theater and Penthouse", "Hookah Lounge and Billiards Room", "Blue Bar and Sunrise Bar", "Service Entrance and Kitchen"]],
            ["consulate", ["Consul Office and Meeting Room", "Lobby and Press Room", "Garage and Cafeteria", "Tellers and Archives"]],
            ["kafe", ["Cocktail Lounge and Bar", "Mining Room and Fireplace Hall", "Reading Room and Fireplace Hall", "Kitchen Service and Kitchen Cooking"]],
            ["kanal", ["Server Room and Radar Room", "Security Room and Map Room", "Coast Guard Meeting Room and Lounge", "Supply Room and Kayaks"]],
            ["oregon", ["Main Dorms Hall and Kids Dorm", "Dining Hall and Kitchen", "Meeting Hall and Kitchen", "Laundry Room and Supply Room"]],
            ["outback", ["Games Room and Laundry Room", "Party Room and Office", "Nature Room and Bushranger Office", "Gear Store and Compressor"]],
            ["park", ["Office and Initiation Room", "Bunk and Day Care", "Armory and Throne Room", "Lab and Storage"]],
            ["skyscraper", ["Tea Room and Karaoke", "Exhibition Room and Office", "Kitchen and BBQ", "Bedroom and Bathroom"]],
            ["villa", ["Aviator Room and Games Room", "Trophy Room and Statuary Room", "Living Room and Library", "Dining Room and Kitchen"]]
        ]);

        var map;

        $('#all-site-info').hide();

        function loadSites() {
            $('#all-site-info').hide();

            map = $('#map-selection').val();

            $('#site-selection').val('default');

            $('#site0').text(allSites.get(map)[0]);
            $('#site1').text(allSites.get(map)[1]);
            $('#site2').text(allSites.get(map)[2]);
            $('#site3').text(allSites.get(map)[3]);

            $('#site-selection-div').show();
        }

        function submitSiteData() {
            $('#submit').hide();
            
            var site = $('#site-selection').val();
            database.ref("squads/" + squadName + "/site-data/" + map + "/site" + site).once('value').then(function(snapshot) {
                var role = document.querySelector('input[name="role"]:checked').value;
                var winStatus = document.querySelector('input[name="success"]:checked').value;
                var plantStatus = document.querySelector('input[name="planted"]:checked').value;

                var roundStatus = role + winStatus;
                database.ref("squads/" + squadName + "/site-data/" + map + "/site" + site + "/" + roundStatus).set(snapshot.val()[roundStatus] + 1);

                if (plantStatus == "yes") {
                    database.ref("squads/" + squadName + "/site-data/" + map + "/site" + site + "/p" + roundStatus).set(snapshot.val()["p" + roundStatus] + 1);
                }

                $('#attack').prop('checked', false);
                $('#defend').prop('checked', false);
                $('#win').prop('checked', false);
                $('#loss').prop('checked', false);
                $('#yes').prop('checked', false);
                $('#no').prop('checked', false);

                loadSiteData();
            });
        }

        function loadSiteData() {
            $('#all-site-info').show();
            $('#attack').prop('checked', false);
            $('#defend').prop('checked', false);
            $('#win').prop('checked', false);
            $('#loss').prop('checked', false);
            $('#yes').prop('checked', false);
            $('#no').prop('checked', false);
            $('#submit').hide();
            
            var site = $('#site-selection').val();
            if (site != "default") {
                database.ref("squads/" + squadName + "/site-data/" + map + "/site" + site).once('value').then(function(snapshot) {
                    $('#attacking-wins').text("Attacking wins: " + snapshot.val().awin);
                    $('#attacking-losses').text("Attacking losses: " + snapshot.val().aloss);

                    $('#successful-plants').text("Successful defuser plants: " + snapshot.val().pawin);
                    $('#failed-plants').text("Failed defuser plants: " + snapshot.val().paloss);

                    $('#defending-wins').text("Defending wins: " + snapshot.val().dwin);
                    $('#defending-losses').text("Defending losses: " + snapshot.val().dloss);

                    $('#successful-disables').text("Defusers disabled: " + snapshot.val().pdwin);
                    $('#failed-disables').text("Defusers not disabled: " + snapshot.val().pdloss);
                });
            }
        }

        function checkAllRadio() {
            if (document.querySelector('input[name="role"]:checked') != null && document.querySelector('input[name="success"]:checked') != null && document.querySelector('input[name="planted"]:checked') != null) {
                $('#submit').show();
            }
        }
    </script>
</body>
</html>