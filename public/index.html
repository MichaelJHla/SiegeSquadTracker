<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Siege Squad Tracker</title>
</head>

<body>
    <div id="welcome">

    </div>

    <div id="new-user">
        <h2>New User Sign Up</h2>
        <input type="radio" id="xbox" value="xbox" name="platform">
        <label for="xbox">Xbox</label>

        <input type="radio" id="playstation" value="playstation" name="platform">
        <label for="playstation">PlayStation</label>
        
        <input type="radio" id="pc" value="pc" name="platform">
        <label for="pc">PC</label>

        <br />

        <label for="platform-username">Platform name</label>
        <input id="platform-username">

        <label for="squad-name">Squad name</label>
        <input id="squad-name">

        <label for="signup-email">Email</label>
        <input id="signup-email">

        <label for="signup-password">Password</label>
        <input type="password" id="signup-password">

        <button id="signup-button" onclick="newUser()">Sign Up</button>
    </div>

    <div id="sign-in">
        <h2>Sign In</h2>
        <label for="login-email">Email</label>
        <input id="login-email">

        <label for="login-password">Password</label>
        <input type="password" id="login-password">

        <button id="login-button" onclick="logIn()">Log In</button>
    </div>

    <!--All scripts below here-->
    <!-- Firebase App (the core Firebase SDK) is always required and must be listed first -->
    <script src="https://www.gstatic.com/firebasejs/8.1.1/firebase-app.js"></script>
    <!-- Database CDN -->
    <script src="https://www.gstatic.com/firebasejs/8.1.1/firebase-database.js"></script>
    <!-- Authentication CDN -->
    <script src="https://www.gstatic.com/firebasejs/8.1.1/firebase-auth.js"></script>
    <!--Configuration information for firebase-->
    <script src="scripts/firebaseConfig.js"></script>
    <!--jQuery import-->
    <script src="scripts/jquery.js"></script>

    <script>
        //Get the current status of the user's login
        auth.onAuthStateChanged(user => {
            if (user) {
                localStorage.setItem("userid", user.uid);
                database.ref("users/" + user.uid).once('value').then(function(snapshot) {
                    //Save the user information to local storage for quick access on other web pages
                    localStorage.setItem("squadname", snapshot.val().squad);

                    window.location.replace("html/map-bans.html"); //Redirect to the map bans page of the site
                });
            }
        });

        //This function is used to create a new user
        function newUser() {
            var email = $('#signup-email').val();
            var password = $('#signup-password').val();
            var platform = document.querySelector('input[name="platform"]:checked').value;
            var username = $('#platform-username').val();
            var squad = $('#squad-name').val();

            //Sign up the new user
            auth.createUserWithEmailAndPassword(email, password).then(cred => {
                database.ref("users/" + cred.user.uid + "/platform").set(platform);
                database.ref("users/" + cred.user.uid + "/squad").set(squad);
                database.ref("users/" + cred.user.uid + "/username").set(username);

                var i;
                maps = ["bank", "border", "chalet", "clubhouse", "coastline",
                        "consulate", "kafe", "kanal", "oregon", "outback", "skyscraper",
                        "park", "villa"];
                //Initializes each map in alphabetical order on the map bans page
                for (i = 0; i < maps.length; i++) {
                    database.ref("users/" + cred.user.uid + "/map-bans/" + maps[i]).set(i);
                }

                database.ref("squads/" + squad + "/members/" + cred.user.uid).set(username);
            });
        }

        //This function is used to sign in a previously made user
        function logIn() {
            var email = $('#login-email').val();
            var password = $('#login-password').val();

            auth.signInWithEmailAndPassword(email, password).then(cred => {
                
            });
        }
    </script>
</body>
</html>